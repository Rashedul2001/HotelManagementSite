@using HotelManagementSite.Models.ViewModels
@model PagedResult<UserModel>

@{
    int index = 0;
    string arrow = Model.SortOrder == "asc" ? "↑" : "↓";
}

<!-- Users Table -->
<div class="table-container">
    <div class="overflow-x-auto">
        <table class="w-full">
            <thead class="border-b border-white/10 bg-white/10">
                <tr>
                    <th class="p-6 text-left font-semibold text-gray-700">
                        <button class="sort-btn flex items-center space-x-1 hover:text-blue-600 transition-colors duration-200" 
                                data-sort="name">
                            <span>User</span>
                            @if (Model.SortBy.Equals("name", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="text-blue-600">@arrow</span>
                            }
                            else
                            {
                                <span class="text-gray-400">↕</span>
                            }
                        </button>
                    </th>
                    <th class="p-6 text-left font-semibold text-gray-700">
                        <button class="sort-btn flex items-center space-x-1 hover:text-blue-600 transition-colors duration-200" 
                                data-sort="role">
                            <span>Role</span>
                            @if (Model.SortBy.Equals("role", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="text-blue-600">@arrow</span>
                            }
                            else
                            {
                                <span class="text-gray-400">↕</span>
                            }
                        </button>
                    </th>
                    <th class="p-6 text-left font-semibold text-gray-700">
                        <button class="sort-btn flex items-center space-x-1 hover:text-blue-600 transition-colors duration-200" 
                                data-sort="phone">
                            <span>Phone Number</span>
                            @if (Model.SortBy.Equals("phone", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="text-blue-600">@arrow</span>
                            }
                            else
                            {
                                <span class="text-gray-400">↕</span>
                            }
                        </button>
                    </th>
                    <th class="p-6 text-left font-semibold text-gray-700">
                        <button class="sort-btn flex items-center space-x-1 hover:text-blue-600 transition-colors duration-200" 
                                data-sort="address">
                            <span>Address</span>
                            @if (Model.SortBy.Equals("address", StringComparison.OrdinalIgnoreCase))
                            {
                                <span class="text-blue-600">@arrow</span>
                            }
                            else
                            {
                                <span class="text-gray-400">↕</span>
                            }
                        </button>
                    </th>
                    <th class="p-6 text-left font-semibold text-gray-700">Actions</th>
                </tr>
            </thead>
            <tbody>
                @if (Model == null || !Model.Items.Any())
                {
                    <tr>
                        <td colspan="5" class="p-6 text-center text-gray-500">No users found.</td>
                    </tr>
                }
                else
                {
                    foreach (var user in Model.Items)
                    {
                        <tr class="animate-slide-up table-row" style="animation-delay: @(index * 100)ms">
                            <td class="p-6">
                                <div class="flex items-center space-x-4">
                                    <div class="flex h-10 w-10 items-center justify-center rounded-full bg-gradient-to-br from-blue-400 to-purple-500 shadow-lg">
                                        @await Html.PartialAsync("Icons/UsersIcon", "h-6 w-6 text-white")
                                        <div class="text-white"></div>
                                    </div>
                                    <div>
                                        <div class="font-semibold text-gray-900">@user.Name</div>
                                        <div class="text-sm text-gray-600">@user.Email</div>
                                    </div>
                                </div>
                            </td>
                            <td class="p-6">
                                <span class="inline-flex items-center rounded-full px-2.5 py-0.5 text-xs font-medium @(GetRoleColorClass(user.Role))">
                                    @user.Role
                                </span>
                            </td>
                            <td class="p-6">
                                <span class="inline-flex items-center rounded-full bg-green-100 px-2.5 py-0.5 text-xs font-medium text-green-800">
                                    @user.PhoneNumber
                                </span>
                            </td>
                            <td class="p-6 text-gray-700">
                                @user.Address
                            </td>
                            <td class="p-6">
                                <div class="flex space-x-1">
                                    <button class="rounded-lg p-1 transition-colors duration-200 hover:bg-blue-100 hover:text-blue-600" title="Edit User">
                                        @await Html.PartialAsync("Icons/EditIcon", "h-6 w-6")
                                    </button>
                                    <button class="rounded-lg p-1 transition-colors duration-200 hover:bg-red-100 hover:text-red-600" title="Delete User">
                                        @await Html.PartialAsync("Icons/DeleteIcon", "h-6 w-6")
                                    </button>
                                    <button class="rounded-lg p-1 transition-colors duration-200 hover:bg-green-100 hover:text-green-600" title="User Details">
                                        @await Html.PartialAsync("Icons/UserDetailsIcon", "h-6 w-6")
                                    </button>
                                </div>
                            </td>

                        </tr>
                        index++;
                    }
                }
            </tbody>
        </table>
    </div>
</div>

@if (Model != null && Model.TotalPages > 0)
{
    <!-- Pagination -->
    <div class="flex items-center justify-between">
        <div class="text-sm text-gray-600">
            Showing @Model.StartItemIndex to @Model.EndItemIndex of @Model.TotalItems users
        </div>
        <div class="flex items-center space-x-2">
            @if (Model.CurrentPage > 1)
            {
                <button data-page="@(Model.CurrentPage - 1)"
                        class="page-btn rounded-lg border border-white/20 bg-white/50 px-3 py-2 backdrop-blur-sm transition-all duration-200 hover:bg-white/70">
                    <i class="fas fa-chevron-left"></i>
                </button>
            }

            @{
                int startPage = Math.Max(1, Model.CurrentPage - 2);
                int endPage = Math.Min(Model.TotalPages, Model.CurrentPage + 2);
            }

            @if (startPage > 1)
            {
                <button data-page="1" class="page-btn rounded-lg px-3 py-2 bg-white/50 backdrop-blur-sm border border-white/20 hover:bg-white/70 text-gray-700 transition-all duration-200">1</button>
                @if (startPage > 2)
                {
                    <span class="px-2 text-gray-500">...</span>
                }
            }

            @for (int i = startPage; i <= endPage; i++)
            {
                <button data-page="@i"
                        class="page-btn rounded-lg px-3 py-2 transition-all duration-200 @(i == Model.CurrentPage ? "bg-gradient-to-r from-blue-500 to-purple-600 text-white" : "bg-white/50 backdrop-blur-sm border border-white/20 hover:bg-white/70 text-gray-700")">
                    @i
                </button>
            }

            @if (endPage < Model.TotalPages)
            {
                @if (endPage < Model.TotalPages - 1)
                {
                    <span class="px-2 text-gray-500">...</span>
                }
                <button data-page="@Model.TotalPages" class="page-btn rounded-lg px-3 py-2 bg-white/50 backdrop-blur-sm border border-white/20 hover:bg-white/70 text-gray-700 transition-all duration-200">@Model.TotalPages</button>
            }

            @if (Model.CurrentPage < Model.TotalPages)
            {
                <button data-page="@(Model.CurrentPage + 1)"
                        class="page-btn rounded-lg border border-white/20 bg-white/50 px-3 py-2 backdrop-blur-sm transition-all duration-200 hover:bg-white/70">
                    <i class="fas fa-chevron-right"></i>
                </button>
            }
        </div>
    </div>
}

<!-- Store current sort state as hidden inputs for JavaScript -->
<input type="hidden" id="currentSortBy" value="@Model.SortBy" />
<input type="hidden" id="currentSortOrder" value="@Model.SortOrder" />

@functions {
    string GetRoleColorClass(string role)
    {
        return role?.ToLower() switch
        {
            "superadmin" => "bg-red-100 text-red-800",
            "admin" => "bg-purple-100 text-purple-800",
            "manager" => "bg-blue-100 text-blue-800",
            "staff" => "bg-green-100 text-green-800",
            "guest" => "bg-yellow-100 text-yellow-800",
            "user" => "bg-indigo-100 text-indigo-800",
            _ => "bg-gray-100 text-gray-800"
        };
    }
}